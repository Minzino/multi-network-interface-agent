# MultiNIC Agent μ μ§„μ  κ°μ„  ν”„λ΅μ νΈ

## π“… μ„Έμ… μ •λ³΄
- **μ‹μ‘μΌ**: 2025-08-29
- **ν„μ¬ μƒνƒ**: 5λ‹¨κ³„ μ™„λ£ - Controller Watch/Job μ¤μΌ€μ¤„λ§ λ° μƒνƒ λ°μ κµ¬ν„
- **λ‹¤μ μ‘μ—…**: 6λ‹¨κ³„ ν†µν•© ν…μ¤νΈ λ° μ„±λ¥ κ²€μ¦(E2E)

## π― ν”„λ΅μ νΈ λ©ν‘

### ν•µμ‹¬ λ¬Έμ μ  (κΈ°μ΅΄ μ•„ν‚¤ν…μ²)
1. **ν™•μ¥μ„± λ¬Έμ **: ν΄λ¬μ¤ν„° μ „μ²΄ CRDλ΅ μΈν• etcd μ©λ‰ μ ν•
2. **λ™μ‹μ„± μ¶©λ**: μ—¬λ¬ Jobμ΄ λ™μΌν• CR λ™μ‹ μ—…λ°μ΄νΈ
3. **λ³΄μ• κ¶ν• κ³Όλ‹¤**: Job Podλ“¤μ΄ ν΄λ¬μ¤ν„° μ „μ²΄ μμ • κ¶ν• ν•„μ”
4. **μ•„ν‚¤ν…μ² μ•ν‹°ν¨ν„΄**: Jobμ΄ μ§μ ‘ CR μƒνƒ μ—…λ°μ΄νΈ

### ν•΄κ²° λ°©ν–¥
- **κΈ°μ΅΄ λ°©μ‹**: β μ „μ²΄ μ•„ν‚¤ν…μ² μ¬μ„¤κ³„ (Clean Slate)
- **μμ •λ λ°©μ‹**: β… κ²€μ¦λ λ΅μ§ μ¬μ‚¬μ© + μµμ†ν• λ³€κ²½ + μ•μ „ν• Git μ›ν¬ν”λ΅μ°

## π”„ ν•µμ‹¬ κ²°μ •μ‚¬ν•­

### 1. Clean Slate μ ‘κ·Όλ²• νκΈ°
**μ΄μ **: μ‚¬μ©μ μ§€μ  - "DaemonSet vs Job = λ‹¨μν μ‹¤ν–‰ λ°©μ‹ μ°¨μ΄"
- λ„¤νΈμ›ν¬ λ΅μ§ μμ²΄λ” κ²€μ¦λμ–΄ μ‘λ™ν•¨
- λ¶ν•„μ”ν• λ³µμ΅μ„±κ³Ό λ¦¬μ¤ν¬ μ κ±°
- κ°λ° ν¨μ¨μ„± μ°μ„ 

### 2. main λΈλμΉ κΈ°λ° μ μ§„μ  κ°μ„  μ±„νƒ
**μ¥μ **:
- κ²€μ¦λ λ„¤νΈμ›ν¬ λ΅μ§ 100% μ¬μ‚¬μ©
- μµμ†ν•μ λ³€κ²½μΌλ΅ μµλ€ ν¨κ³Ό
- κ° λ‹¨κ³„λ³„ λ…λ¦½ ν…μ¤νΈ κ°€λ¥
- μ–Έμ λ“  λλλ¦¬κΈ° κ°€λ¥ν• μ•μ „μ„±

### 3. Git μ›ν¬ν”λ΅μ° κ°μ„ 
```bash
git checkout main
git pull origin main
git checkout -b feature/node-based-clean-architecture
```

## π“‹ 7λ‹¨κ³„ κµ¬ν„ κ³„ν

### 0λ‹¨κ³„: Git μ›ν¬ν”λ΅μ° μ¤€λΉ„ β…
**λ©ν‘**: μ•μ „ν• κ°λ° ν™κ²½ κµ¬μ„±
**μƒνƒ**: β… μ™„λ£ (2025-08-29)
**μ‘μ—…**:
- β… main λΈλμΉλ΅ μ²΄ν¬μ•„μ›ƒ
- β… μƒ λΈλμΉ μƒμ„± (feature/node-based-clean-architecture)
- β… κΉ”λ”ν• μ‹μ‘μ  ν™•λ³΄

### 1λ‹¨κ³„: main λΈλμΉ λ¶„μ„ β…
**λ©ν‘**: ν„μ¬ λ„¤νΈμ›ν¬ λ΅μ§ νμ•… λ° μ¬μ‚¬μ© κ°€λ¥ λ¶€λ¶„ μ‹λ³„
**μƒνƒ**: β… μ™„λ£ (2025-08-29)
**μ‘μ—…**:
- β… λ„¤νΈμ›ν¬ μ„¤μ • λ΅μ§ λ¶„μ„ (netplan/ifcfg)
- β… Agent κµ¬μ΅° νμ•…
- β… μ¬μ‚¬μ© κ°€λ¥ν• μ»΄ν¬λ„νΈ μ‹λ³„
- β… κ²€μ¦λ λ΅μ§ 100% μ¬μ‚¬μ© κ°€λ¥ ν™•μΈ

**π”‘ μ£Όμ” λ°κ²¬μ‚¬ν•­**:
- **Ubuntu Netplan μ–΄λ‘ν„°**: `internal/infrastructure/network/netplan_adapter.go` - μ™„μ „ μ¬μ‚¬μ© κ°€λ¥
- **RHEL ifcfg μ–΄λ‘ν„°**: `internal/infrastructure/network/rhel_adapter.go` - μ™„μ „ μ¬μ‚¬μ© κ°€λ¥  
- **OS κ°μ§€ ν©ν† λ¦¬**: `internal/infrastructure/network/factory.go` - μ™„μ „ μ¬μ‚¬μ© κ°€λ¥
- **λΉ„μ¦λ‹μ¤ λ΅μ§**: `internal/application/usecases/configure_network.go` - 90% μ¬μ‚¬μ© (λ°μ΄ν„° μ†μ¤λ§ λ³€κ²½)
- **Agent ν”„λ μ„μ›ν¬**: `cmd/agent/main.go` - 85% μ¬μ‚¬μ© (μ‹¤ν–‰ λ¨λ“λ§ λ³€κ²½)

### 2λ‹¨κ³„: MultiNicNodeConfig CRD μƒμ„± π“
**λ©ν‘**: λ…Έλ“λ³„ CRD μ •μ
**μƒνƒ**: β… μ™„λ£ (2025-08-29)
**μ‘μ—… κ²°κ³Ό**:
- β… CRD μ¤ν‚¤λ§ μ •μ λ° μƒμ„± (`deployments/crds/multinicnodeconfig-crd.yaml`)
- β… `spec.nodeName`, `spec.interfaces[]` λ‹¨μ κµ¬μ΅°
- β… `spec.instanceId`(OpenStack UUID) μ¶”κ°€λ΅ λ…Έλ“ λ§¤ν•‘ λ³΄κ°•
- β… `status.state`, `conditions[]`, `interfaceStatuses[]` ν¬ν•¨

### 3λ‹¨κ³„: Agent λ°μ΄ν„° μ†μ¤ λ³€κ²½ π”„
**λ©ν‘**: DB μ½κΈ° β†’ NodeCR μ½κΈ°λ΅ λ³€κ²½
**μƒνƒ**: β… μ™„λ£ (2025-08-29)
**μ‘μ—… κ²°κ³Ό**:
- β… κΈ°μ΅΄ λ„¤νΈμ›ν¬ λ΅μ§ 100% μ μ§€ (μ μ¤μΌ€μ΄μ¤/μ–΄λ‘ν„° λ¬΄λ³€κ²½)
- β… `NodeCR` λ ν¬μ§€ν† λ¦¬ μ¶”κ°€: `internal/infrastructure/persistence/nodecr_repository.go`
- β… Kube API λ™μ  ν΄λΌμ΄μ–ΈνΈ μ†μ¤: `internal/infrastructure/persistence/nodecr_source_k8s.go`
- β… DI μ¤μ„μΉ: `DATA_SOURCE=nodecr` μ‹ DB λ¶ν•„μ”
- β… TDD ν…μ¤νΈ: λ ν¬μ§€ν† λ¦¬/μ†μ¤/μ»¨ν…μ΄λ„

**ν™κ²½ λ³€μ (κµ¬μ„± μµμ…)**:
- `DATA_SOURCE`: `db`(κΈ°λ³Έ) | `nodecr`
- `NODE_CR_NAMESPACE`: NodeCRμ΄ μ„μΉν• λ„¤μ„μ¤νμ΄μ¤ (κΈ°λ³Έ: `multinic-system`)

**κµ¬ν„ λ©”λ¨**:
- Kube API κΈ°λ° μ΅°ν: `dynamic.Interface`λ΅ `multinic.io/v1alpha1` `multinicnodeconfigs`
- ν…μ¤νΈ: client-go `dynamic/fake`λ΅ λ‹¨μ„ ν…μ¤νΈ

**μ£Όμ**: NodeCR μ•„ν‚¤ν…μ²μ—μ„λ” Agentκ°€ CR `status`λ¥Ό μ§μ ‘ μμ •ν•μ§€ μ•μ. `UpdateInterfaceStatus`λ” no-opμ΄λ©°, μƒνƒ μ—…λ°μ΄νΈλ” 5λ‹¨κ³„ Controllerκ°€ λ‹΄λ‹Ή.

### 4λ‹¨κ³„: Agent μ‹¤ν–‰ λ°©μ‹ λ³€κ²½ β™οΈ
**λ©ν‘**: DaemonSet β†’ Job μ‹¤ν–‰ λ°©μ‹ λ³€κ²½
**μƒνƒ**: β… μ™„λ£ (2025-08-29)
**μ‘μ—… κ²°κ³Ό**:
- β… `NODE_NAME <- spec.nodeName` ν™κ²½λ³€μ μ°μ„  μ‚¬μ© (`cmd/agent/main.go`)
- β… Helm Job ν…ν”λ¦Ώ μ¶”κ°€ (`deployments/helm/templates/job.yaml`)
- β… DS/Jobμ—μ„ host-root λ§μ΄νΈ μ κ±°, OSλ³„ ν•„μ”ν• κ²½λ΅λ§ μ‚¬μ©
- β… Job λ‹¨λ° μ‹¤ν–‰ λ¨λ“ μ¶”κ°€: `RUN_MODE=job`μΌ λ• 1ν μ²λ¦¬ ν›„ μΆ…λ£ (ν΄λ§ μ—†μ)

### 5λ‹¨κ³„: Controller μƒμ„± π›οΈ
**λ©ν‘**: CRD κ°μ‹ λ° Job μ¤μΌ€μ¤„λ§ λ΅μ§ κµ¬ν„
**μƒνƒ**: β… μ™„λ£ (2025-08-29)
**μ‘μ—… κ²°κ³Ό**:
- β… Reconciler: Node OS μλ™ κ°μ§€(`osImage`)β†’ OSλ³„ λ§μ΄νΈ ν¬ν•¨ Job μƒμ„±
- β… Instance λ§¤ν•‘ κ²€μ¦: `spec.instanceId` β†” `Node.status.nodeInfo.systemUUID`
- β… Status λ°μ: InProgress β†’ Configured/Failed
- β… Watcher/Service(ν΄λ§) μ¶”κ°€, Controller λ°”μ΄λ„λ¦¬(`cmd/controller/main.go`)
- β… Helm Deployment/ RBAC μ¶”κ°€
  - `deployments/helm/templates/controller-deployment.yaml`
  - `deployments/helm/templates/rbac.yaml`
- β… λ§μ¤ν„° λ…Έλ“ μ¤μΌ€μ¤„ ν—μ©: Job tolerations μ¶”κ°€(`control-plane`/`master` NoSchedule ν—μ©)
- β… μ»¨νΈλ΅¤λ¬ λ΅κΉ… κ°•ν™”: Reconcile/Job μƒμ„±/μ„±κ³µ/μ‹¤ν¨/Watcher μ΄λ²¤νΈ λ΅κ·Έ μ¶λ ¥
 - β… Job μλ… μ£ΌκΈ°: μ„±κ³µ/μ‹¤ν¨ μ§ν›„ Controllerκ°€ μ¦‰μ‹ Job μ‚­μ (κΈ°λ³Έ μ •μ±…)
   - (μµμ…) TTL μ„¤μ •μ€ μ•μ „λ§μΌλ΅λ§ μ‚¬μ© β€” μ»¨νΈλ΅¤λ¬ λ‹¤μ΄/κ¶ν• μ΄μ λ“±μΌλ΅ μ¦‰μ‹ μ‚­μ κ°€ μ‹¤ν¨ν•λ” λ“λ¬Έ μƒν™©μ—μ„ K8sκ°€ μµμΆ… μ²­μ†
- β… CR μ‚­μ  μ΄λ²¤νΈ μ²λ¦¬: Watcher DeleteFuncλ΅ CR μ‚­μ  μ‹ ν•΄λ‹Ή λ…Έλ“ Job μ •λ¦¬

### 6λ‹¨κ³„: Controller λ΅κΉ… λ° CR μƒνƒ κ°μ„  β…
**λ©ν‘**: μ΄μμ„± ν–¥μƒμ„ μ„ν• λ΅κΉ… λ° μƒνƒ κ΄€λ¦¬ κ°μ„ 
**μƒνƒ**: β… μ™„λ£ (2025-08-29)
**μ‘μ—… κ²°κ³Ό**:
- β… **μ‚­μ  κΈ°λ¥ λ””λ²„κΉ… λ° μμ •**
  - CR μ‚­μ  μ΄λ²¤νΈ μ²λ¦¬ λ¬Έμ  ν•΄κ²°: `handleCRDelete` ν•¨μ νΈμ¶ ν™•μΈ
  - μ‚­μ  cleanup job μƒμ„± μ„±κ³µν•λ‚ DB μμ΅΄μ„± λ¬Έμ  λ°κ²¬
  - `DeleteNetworkUseCase`μ— cleanup λ¨λ“ μ¶”κ°€: `AGENT_ACTION=cleanup` ν™κ²½λ³€μλ΅ DB μ—†μ΄ μ „μ²΄ μ •λ¦¬
  - multinic* νμΌ μ „μ²΄ μ •λ¦¬ λ΅μ§ κµ¬ν„ (netplan/ifcfg λ¨λ‘ μ§€μ›)

- β… **μƒμ„Έν• μΈν„°νμ΄μ¤ λ΅κΉ…**
  - `logInterfaceDetails` ν•¨μ μ¶”κ°€: κ° μΈν„°νμ΄μ¤μ ID, MAC, IP, CIDR, MTU μ •λ³΄ λ΅κΉ…
  - CR μƒμ„±/μμ • μ‹ μ²λ¦¬λλ” μΈν„°νμ΄μ¤ μ •λ³΄ μ‹¤μ‹κ°„ μ¶”μ  κ°€λ¥
  - "=== Interface Details ===" ν•νƒμ κµ¬μ΅°ν™”λ λ΅κ·Έ μ¶λ ¥

- β… **CR μƒνƒ μ—…λ°μ΄νΈ κ°μ„ **
  - `buildInterfaceStatuses` ν•¨μλ΅ μΈν„°νμ΄μ¤λ³„ μƒμ„Έ μƒνƒ μƒμ„±
  - `interfaceStatuses` ν•„λ“μ— κ° μΈν„°νμ΄μ¤μ μƒμ„Έ μ •λ³΄ ν¬ν•¨ (ID, MAC, IP, μƒνƒ λ“±)
  - `lastUpdated` νƒ€μ„μ¤νƒ¬ν”„λ΅ μƒνƒ λ³€κ²½ μ‹μ  μ¶”μ 
  - Job μ„±κ³µ/μ‹¤ν¨ μ‹μ—λ„ μΈν„°νμ΄μ¤λ³„ μƒμ„Έ μ •λ³΄ CRμ— λ°μ

- β… **μ‹¤μ‹κ°„ μΈν„°νμ΄μ¤ μƒνƒ λ°μ**
  - `updateInterfaceStates` ν•¨μλ΅ μ‹¤μ  λ…Έλ“ μƒνƒ ν™•μΈ
  - `buildEnhancedInterfaceStatuses`λ΅ μ‹¤μ  μ‹μ¤ν… μƒνƒ λ°μ
  - `getActualInterfaceState`λ΅ λ…Έλ“ μ¤€λΉ„ μƒνƒ κΈ°λ° μΈν„°νμ΄μ¤ μƒνƒ ν™•μΈ
  - `ProcessAll`μ—μ„ reconcileκ³Ό ν•¨κ» μΈν„°νμ΄μ¤ μƒνƒ μ—…λ°μ΄νΈ μ‹¤ν–‰
  - `lastInterfaceCheck`, `nodeReady` ν•„λ“λ΅ μ¶”κ°€ μ»¨ν…μ¤νΈ μ κ³µ

**κ°μ„  ν¨κ³Ό**:
- μ΄μμκ°€ μ–΄λ–¤ μΈν„°νμ΄μ¤κ°€ μ–Έμ  μ–΄λ–¤ μƒνƒλ΅ λ³€κ²½λμ—λ”μ§€ μ •ν™•ν μ¶”μ  κ°€λ¥
- CR μ‚­μ  μ‹ ν•΄λ‹Ή λ…Έλ“μ λ„¤νΈμ›ν¬ μΈν„°νμ΄μ¤ νμΌ μ™„μ „ μ •λ¦¬
- μ‹¤μ‹κ°„ λ΅κ·Έλ΅ ν„μ¬ μ²λ¦¬ μ¤‘μΈ μΈν„°νμ΄μ¤ ν™•μΈ κ°€λ¥
- CR statusμ—μ„ κ° μΈν„°νμ΄μ¤μ ν„μ¬ μƒνƒμ™€ λ³€κ²½ μ΄λ ¥ ν™•μΈ

### 7λ‹¨κ³„: ν†µν•© ν…μ¤νΈ λ° μ„±λ¥ κ²€μ¦ π“
**λ©ν‘**: μ „μ²΄ ν”λ΅μ° κ²€μ¦
**μƒνƒ**: β³ λ€κΈ° μ¤‘
**μ‘μ—…**: E2E ν…μ¤νΈ λ° μ„±λ¥ κ²€μ¦

## π’΅ μμƒ ν¨κ³Ό

### κΈ°μ μ  μ¥μ 
- **ν™•μ¥μ„±**: λ…Έλ“λ‹Ή ~5KB CR β†’ 1000 λ…Έλ“λ„ λ¬Έμ μ—†μ
- **μ„±λ¥**: λ³‘λ ¬ μ²λ¦¬, λ¶€λ¶„ μ‹¤ν¨ κ²©λ¦¬
- **λ³΄μ•**: μµμ† κ¶ν• μ›μΉ™ μ¤€μ
- **μ΄μμ„±**: λ…Έλ“λ³„ λ…λ¦½μ  λ¬Έμ  ν•΄κ²°

### κ°λ° ν¨μ¨μ„±
- **λ¦¬μ¤ν¬ μµμ†ν™”**: κ²€μ¦λ μ½”λ“ μ¬μ‚¬μ©
- **κ°λ° μ‹κ°„**: λ„¤νΈμ›ν¬ λ΅μ§ μ¬μ‘μ„± λ¶ν•„μ”
- **Git νμ¤ν† λ¦¬**: κΉ”λ”ν•κ³  μ¶”μ  κ°€λ¥ν• λ³€κ²½ μ΄λ ¥
- **ν€ ν‘μ—…**: μ΄ν•΄ν•κΈ° μ‰¬μ΄ μ μ§„μ  λ³€ν™”

## π€ λ‹¤μ μ„Έμ… κ°€μ΄λ“

### μ‹μ‘ ν”„λ΅¬ν”„νΈ
```
μ•λ…•ν•μ„Έμ”! 

docs/SESSION_PROGRESS.mdλ¥Ό ν™•μΈν•κ³  MultiNIC Agent μ μ§„μ  κ°μ„ μ 7λ‹¨κ³„λ¥Ό μ‹μ‘ν•΄μ£Όμ„Έμ”.

ν„μ¬ μƒνƒ:
- β… 0~5λ‹¨κ³„: μ™„λ£ (Git μ›ν¬ν”λ΅μ°, CRD, Agent, Controller κµ¬ν„)
- β… 6λ‹¨κ³„: Controller λ΅κΉ… λ° CR μƒνƒ κ°μ„  μ™„λ£

μ™„λ£λ μ£Όμ” κΈ°λ¥:
- CR μ‚­μ  μ‹ cleanup jobμΌλ΅ λ„¤νΈμ›ν¬ νμΌ μ •λ¦¬
- Controllerμ—μ„ μΈν„°νμ΄μ¤λ³„ μƒμ„Έ λ΅κΉ… (ID, MAC, IP, CIDR, MTU)
- CR statusμ— interfaceStatuses ν•„λ“λ΅ κ° μΈν„°νμ΄μ¤ μƒνƒ μ¶”μ 
- μ‹¤μ‹κ°„ μΈν„°νμ΄μ¤ μƒνƒ λ°μ λ΅μ§ (λ…Έλ“ μƒνƒ κΈ°λ°)

7λ‹¨κ³„ λ©ν‘: ν†µν•© ν…μ¤νΈ λ° μ„±λ¥ κ²€μ¦ (E2E)
- μ „μ²΄ ν”λ΅μ° κ²€μ¦: CR μƒμ„± β†’ Job μ¤μΌ€μ¤„λ§ β†’ λ„¤νΈμ›ν¬ μ μ© β†’ μƒνƒ μ—…λ°μ΄νΈ
- μ‚­μ  ν”λ΅μ° κ²€μ¦: CR μ‚­μ  β†’ cleanup job β†’ νμΌ μ •λ¦¬
- λ΅κΉ… λ° μƒνƒ μ¶”μ  κΈ°λ¥ κ²€μ¦
- μ„±λ¥ λ° μ•μ •μ„± ν…μ¤νΈ

/analyze --comprehensive --focus integration-testing
```

### μ§„ν–‰ μ›μΉ™
1. **λ‹¨κ³„λ³„ μ™„λ£**: κ° μ„Έμ…μ—μ„ ν•λ‚μ λ…ν™•ν• λ‹¨κ³„λ§ μ™„λ£
2. **μ»¨ν…μ¤νΈ μ μ§€**: λ§¤ μ„Έμ… μΆ…λ£ μ‹ μ΄ λ¬Έμ„ μ—…λ°μ΄νΈ
3. **μ•μ „μ„± μ°μ„ **: μ–Έμ λ“  λλλ¦΄ μ μλ” μƒνƒ μ μ§€
4. **κ²€μ¦ κΈ°λ°**: κ° λ‹¨κ³„λ³„ λ…λ¦½ ν…μ¤νΈ μν–‰

---

**λ¬Έμ„ μµμΆ… μ—…λ°μ΄νΈ**: 2025-08-29 (6λ‹¨κ³„ μ™„λ£ - Controller λ΅κΉ… λ° CR μƒνƒ κ°μ„ )  
**λ‹¤μ μ—…λ°μ΄νΈ μμ •**: 7λ‹¨κ³„(E2E ν†µν•© ν…μ¤νΈ) μ™„λ£ ν›„

## π“‹ ν„μ¬ μ„Έμ… μ™„λ£ μ‘μ—… μ”μ•½ (6λ‹¨κ³„)

### β… μ™„λ£λ μ£Όμ” κ°μ„ μ‚¬ν•­
1. **CR μ‚­μ  κΈ°λ¥ μ™„μ „ κµ¬ν„**
   - `handleCRDelete` ν•¨μ λ””λ²„κΉ… μ™„λ£
   - `AGENT_ACTION=cleanup` ν™κ²½λ³€μλ΅ DB λ…λ¦½μ μΈ μ „μ²΄ μ •λ¦¬
   - netplan/ifcfg λ¨λ“  multinic* νμΌ μ •λ¦¬ λ΅μ§

2. **μƒμ„Έν• μΈν„°νμ΄μ¤ λ΅κΉ…**
   - `logInterfaceDetails` ν•¨μ μ¶”κ°€
   - κ° μΈν„°νμ΄μ¤μ ID, MAC, IP, CIDR, MTU μ •λ³΄ μ‹¤μ‹κ°„ λ΅κΉ…
   - "=== Interface Details ===" κµ¬μ΅°ν™”λ μ¶λ ¥

3. **CR μƒνƒ κ΄€λ¦¬ λ€ν­ κ°μ„ **
   - `buildInterfaceStatuses`λ΅ μΈν„°νμ΄μ¤λ³„ μƒμ„Έ μƒνƒ μƒμ„±
   - `interfaceStatuses` ν•„λ“μ— κ° μΈν„°νμ΄μ¤ μ •λ³΄ ν¬ν•¨
   - `lastUpdated` νƒ€μ„μ¤νƒ¬ν”„λ΅ λ³€κ²½ μ¶”μ 

4. **μ‹¤μ‹κ°„ μΈν„°νμ΄μ¤ μƒνƒ λ°μ**
   - `updateInterfaceStates`λ΅ μ‹¤μ  λ…Έλ“ μƒνƒ ν™•μΈ
   - `buildEnhancedInterfaceStatuses`λ΅ μ‹μ¤ν… μƒνƒ λ°μ
   - `lastInterfaceCheck`, `nodeReady` μ¶”κ°€ μ»¨ν…μ¤νΈ

### π― μ΄μ ν¨κ³Ό
- **κ°€μ‹μ„±**: μ–΄λ–¤ μΈν„°νμ΄μ¤κ°€ μ–Έμ  μ²λ¦¬λμ—λ”μ§€ λ…ν™•ν μ¶”μ 
- **μ™„μ „μ„±**: CR μ‚­μ  μ‹ λ„¤νΈμ›ν¬ νμΌ μ™„μ „ μ •λ¦¬
- **μ‹¤μ‹κ°„μ„±**: CR statusμ— μ‹¤μ  μΈν„°νμ΄μ¤ μƒνƒ λ°μ
- **λ””λ²„κΉ…**: μƒμ„Έν• λ΅κ·Έλ΅ λ¬Έμ  μ§„λ‹¨ μ©μ΄

## π” μ‹¤ν–‰/κ°μ‹ λ¨λΈ μ •λ¦¬

- κΈ°λ³Έ λ¨λ“: **Watcher(κ¶μ¥)**
  - Controllerκ°€ CRD(MultiNicNodeConfig)λ¥Ό Informerλ΅ κ°μ‹(Add/Update/Delete)
  - μ‚¬μ–‘(spec) λ³€κ²½ μ‹ ν•΄λ‹Ή λ…Έλ“μ—λ§ Job μƒμ„± β†’ Agent Jobμ΄ λ‹¨λ° μ‹¤ν–‰(RUN_MODE=job)μΌλ΅ κµ¬μ„± μ μ©
  - Job μ™„λ£/μ‹¤ν¨ μ‹ Controllerκ°€ CR `status.state`λ¥Ό `Configured/Failed`λ΅ κ°±μ‹ 

- λ³΄μ΅° λ¨λ“: **Polling**
  - μ΄μ ν™κ²½ μ μ•½ λ“±μΌλ΅ Watch μ‚¬μ©μ΄ μ–΄λ ¤μΈ λ• `CONTROLLER_MODE=poll`λ΅ μ£ΌκΈ° μ‹¤ν–‰ κ°€λ¥
  - μ„¤κ³„/κΈ°λ³Έκ°’μ€ Watchμ΄λ©°, Pollμ€ fallback μλ‹¨

## β… μ‹¤λ°°ν¬ κ²€μ¦(μ”μ•½)

- μ»¨νΈλ΅¤λ¬: `multinic-system` λ„¤μ„μ¤νμ΄μ¤μ—μ„ Running (Deployment/Pod)
- μƒν” CR: `deployments/crds/samples/` μ μ© β†’ λ…Έλ“λ³„ CR μƒμ„±
- Job: μ»¨νΈλ΅¤λ¬κ°€ λ°νƒ€μ„ μƒμ„± (Helmμ€ Job μ„¤μΉ μ• ν•¨)
- Worker λ…Έλ“: Job Running β†’ λ„¤νΈμ›ν¬ μ μ© μ„±κ³µ λ΅κ·Έ ν™•μΈ
- Master λ…Έλ“: tolerations λ°μ ν›„ μ¤μΌ€μ¤„ κ°€λ¥

## π§­ λ°°ν¬/μ΄μ μ£Όμμ‚¬ν•­
- λ„¤μ„μ¤νμ΄μ¤ ν†µμΌ: μ»¨νΈλ΅¤λ¬/CRμ€ `multinic-system`μ— λ°°ν¬/μƒμ„±
- CRD: Helm μ°¨νΈ `crds/` ν¬ν•¨(μ„¤μΉ μ‹ μλ™ λ°μ)
- ServiceAccount μ¶©λ μ‹(μ΄λ―Έ μλ™ μƒμ„±λ¨):
  - Helm κ°’μΌλ΅ `--set serviceAccount.create=false --set serviceAccount.name=multinic-agent` μ§€μ •
- Helmμ€ Jobμ„ μ„¤μΉν•μ§€ μ•μ(`job.install=false`); μ»¨νΈλ΅¤λ¬κ°€ λ°νƒ€μ„ μƒμ„±/μ •λ¦¬

## β“ μ„¤κ³„ λ³΄μ™„ Q&A
- Q. "μ¦‰μ‹ μ‚­μ ν•λ”λ° TTLμ€ μ™ ν•„μ”ν•©λ‹κΉ?"
  - A. **ν•„μλ” μ•„λ‹(μµμ…)**μ…λ‹λ‹¤. μ¦‰μ‹ μ‚­μ κ°€ κΈ°λ³Έμ΄μ§€λ§, μ»¨νΈλ΅¤λ¬ λΉ„μ •μƒ μΆ…λ£Β·RBAC μΌμ‹ μ‹¤ν¨Β·λ„¤νΈμ›ν¬ λ‹¨μ  λ“±μΌλ΅ μ‚­μ  νΈμ¶μ΄ λ„λ½λλ” **μμ™Έ μƒν™©**μ„ λ€λΉ„ν• **μ„Έμ΄ν”„ν‹°λ„·**μΌλ΅ TTLμ„ λ‘ μ μμµλ‹λ‹¤. μ΄μ μ •μ±…μƒ λ¶ν•„μ”ν•λ©΄ κ°’μ„ μ κ±°(λ―Έμ„¤μ •)ν•΄λ„ λ¬΄λ°©ν•©λ‹λ‹¤.
